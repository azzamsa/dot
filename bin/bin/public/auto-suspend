#!/bin/sh

lock() {
    i3lock -i "$HOME"/wallpapers/lockscreen.png
}

notify_user() {
    dunstify -u critical -t 4000 "battery warning" "\n$USER, your battery is low"
}

main(){
    acpi -b | awk -F'[,:%]' '{print $2, $3}' | {
        read -r status capacity

        if [ "$status" = Discharging ]; then
            if [ "$capacity" -lt 10 ] && [ "$capacity" -gt 5 ]; then
                notify_user & ogg123 -q ~/sounds/marimbach-low-bat.ogg
            elif [ "$capacity" -lt 5 ]; then
                lock && systemctl hibernate
            fi
        fi
    }
}

while true; do
    main
    sleep 180
done
